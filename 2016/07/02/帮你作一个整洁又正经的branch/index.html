<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 帮你做一个整洁又正经的Branch · Lcrnice</title><meta name="description" content="帮你做一个整洁又正经的Branch - Lcrnice"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/2597892552" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/lcrnice" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">帮你做一个整洁又正经的Branch</h1><div class="post-time">2016年7月2日</div><div class="post-content"><p><img src="http://7xt6wu.com1.z0.glb.clouddn.com/git:GitPullRebase.png" alt="overview"><br>团队协作开发中，都会用到<a href="https://zh.wikipedia.org/wiki/VCS" target="_blank" rel="external"><code>版本控制系统(VCS)</code></a>，通过ta我们能高效、便捷的控制团队中的代码和文件。相比较于SVN，<a href="https://zh.wikipedia.org/wiki/Git" target="_blank" rel="external">Git</a>作为分散式版本控制系統，对于<code>分支(branch)</code>的操作更加健全，通过将开发(develop)、新特性(feature)、热修复(hotfix)等模块化的操作，放到特定分支进行操作，方便管理和推进。在此需求上衍生出了Git的一个扩展集——<a href="http://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html" target="_blank" rel="external">git-flow</a>，能够非常方便的在各个分支间进行操作。但是在<code>Branch</code>带给我们这么多便利的同时，也给我们的维护带来了一些常见的问题。</p>
<h3 id="Q："><a href="#Q：" class="headerlink" title="Q："></a>Q：</h3><p>团队多人开发时，你在使用<a href="http://gitx.frim.nl/" target="_blank" rel="external">GitX</a>查看代码log时，是否遇到过这样的情况…<br><img src="http://7xt6wu.com1.z0.glb.clouddn.com/git:confusionBranches.png" alt="overview"><br>好吧，可能一般不会有这么混乱的分支结构，但如果不多加留意的话，你们团队的分支结构也会很难分辨，给维护分支带来了很大的困难。所以我们心中都希望分支是这样的…<br><img src="http://7xt6wu.com1.z0.glb.clouddn.com/git:cleanBranches.png" alt="overview"><br>当前<code>Branch</code>中，每一次commit都很清晰，正式我们所想要的。  </p>
<p>那么让分支中像图1这么混乱的的原因是什么呢？如何避免产生这种无意义的分支呢？  (｡•ˇ‸ˇ•｡)  </p>
<h3 id="A"><a href="#A" class="headerlink" title="A:"></a>A:</h3><p>原因：<br>在获取代码时，我们通常会使用<code>git pull</code>来拉取origin的代码。而这一步操作，本质上是<code>fetch</code>+<code>merge</code>的结合体，如果只有一个人对远端仓库进行管理的话，不会出现上述问题，但是多人频繁对同一个远端Branch进行操作的话，会因为拉取代码后local和remote对同一文件都进行了修改，git pull会在<code>fetch</code>后对这部分修改自动将本地repo和远端repo进行<code>merge</code>操作，并在终端中提示你当前的merge branch，这就造成了上图充满了<em>梦幻色彩</em>的Branch结构。  </p>
<p>解决方案：<br>使用<code>git pull --rebase</code>替代<code>git pull</code></p>
<h3 id="git-pull-–rebase"><a href="#git-pull-–rebase" class="headerlink" title="git pull –rebase"></a>git pull –rebase</h3><p>使用<code>--rebase</code>时，Git会先将本地的repo暂存起来，并从上次pull时的状态下拉取远端最新的代码，最后在套用本地的变更。这种样相当于对本地Branch进行了一步<code>对齐</code>的操作，这就避免了git pull带来的一些不必要的Merge Branch。<br>这里有一个小细节需要注意：基于如上所说的操作，本地repo相当于重新提交，SHA-1会变，并且会作为最后一次commit(但是提交时间不变)。</p>
<h3 id="关于解决冲突"><a href="#关于解决冲突" class="headerlink" title="关于解决冲突"></a>关于解决冲突</h3><h4 id="Merge-解决冲突"><a href="#Merge-解决冲突" class="headerlink" title="Merge 解决冲突"></a>Merge 解决冲突</h4><p>使用merge时，发生了冲突，merge会在当前分支中提示你存在冲突，当你修改冲突后，需要在把修改作为一次commit提交到当前分支。</p>
<h4 id="Rebase-解决冲突"><a href="#Rebase-解决冲突" class="headerlink" title="Rebase 解决冲突"></a>Rebase 解决冲突</h4><p>使用rebase时，发生冲突时，Git会自动切换到一个新建的临时分支。当在临时分支中解决冲突后，需要<code>git add .</code>将修改加入暂存区(stage area)，在运行<code>git rebase --continue</code>继续rebase，Git会自动切换回原本的分支，此时就完成了冲突的解决，并且<code>不会新增commit</code>，解决冲突的代码归属于本地repo。  </p>
<p>rebase时有多个commit发生冲突，需要解决多次…所以说，rebase在带来整洁、正经分支的同时，也可能会浪费你很多时间来解决冲突，较大规模的代码合并还是推荐使用merge。</p>
<h3 id="“偷懒”技巧"><a href="#“偷懒”技巧" class="headerlink" title="“偷懒”技巧"></a>“偷懒”技巧</h3><p>如果我们希望一直采用<code>--rebase</code>的操作，但是有感觉有时候会忘记加，还需要reset之后重新操作。那么我就在告诉你一个“偷懒”的技巧~<br>为当前项目配置rebase操作：<br>进入.git路径，打开config配置文件，在当前分支配置选项中加入<code>rebase = ture</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[branch &quot;yourBranch&quot;]</span><br><span class="line">    remote = origin</span><br><span class="line">    merge = refs/heads/yourBranch</span><br><span class="line">    rebase = true</span><br></pre></td></tr></table></figure></p>
<p>为mac中所有项目配置rebase操作：<br>直接加到~/.gitconfig中，让所有追踪的Branch都遵守这个规则<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[branch]  </span><br><span class="line">  autosetuprebase = always</span><br></pre></td></tr></table></figure></p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>遵循以上的方式，你就已经做出了一个‘整洁又正经的Branch’了~ 在版本记录中，看着一条整齐划一的提交线，方便管理的同时，心中轻微的强迫症也得到了些许治愈 (❁´▽`❁)</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/07/30/需要设计师知道的一个小细节/" class="prev">上一篇</a><a href="/2016/05/16/面膜时间-的前世今生（一）/" class="next">下一篇</a></div><div class="copyright"> <p>感兴趣可以关注<a href="https://github.com/Lcrnice">我的GitHub</a> 或关注微博<a href="http://weibo.com/u/2597892552/">@Lcrnice丶</a></p><p>© 2015 - 2017 <a href="http://lcrnice.github.com">Lcrnice</a> · Powered by Hexo</p></div></footer></div><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>